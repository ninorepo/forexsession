<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Forex Session Dart Clock</title>
  <style>
    body {
      background: #1e1e1e;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
    }
    canvas {
      margin-top: 20px;
      background-color: #2e2e2e;
      border-radius: 50%;
    }
  </style>
</head>
<body>
  <h1>Forex Session Clock (WIB - Jakarta Time)</h1>
  <canvas id="forexClock" width="500" height="500"></canvas>

  <script>
    const canvas = document.getElementById("forexClock");
    const ctx = canvas.getContext("2d");
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;

    const sessions = [
      { name: "Sydney", start: 5, end: 14, color: "#3fa" },
      { name: "Tokyo", start: 7, end: 16, color: "#f93" },
      { name: "London", start: 14, end: 23, color: "#39f" },
      { name: "New York", start: 20, end: 5, color: "#f33" }
    ];

    const ringWidth = 35;

    function drawClockFace() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      ctx.font = "12px Arial";
      ctx.fillStyle = "white";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";

      for (let hour = 0; hour < 24; hour++) {
        const angle = (hour / 24) * 2 * Math.PI - Math.PI / 2;
        const radius = 215;
        const x = centerX + radius * Math.cos(angle);
        const y = centerY + radius * Math.sin(angle);
        ctx.fillText(hour.toString(), x, y);
      }
    }

    function drawSessionArc(start, end, radius, color) {
      const startAngle = (start / 24) * 2 * Math.PI - Math.PI / 2;
      const endAngle = (end / 24) * 2 * Math.PI - Math.PI / 2;
      ctx.beginPath();
      ctx.arc(centerX, centerY, radius, startAngle, endAngle);
      ctx.strokeStyle = color;
      ctx.lineWidth = ringWidth - 2;
      ctx.lineCap = "butt";
      ctx.stroke();

      // Midpoint for label
      const midAngle = (startAngle + endAngle) / 2;
      const labelRadius = radius - ringWidth / 2;
      const x = centerX + labelRadius * Math.cos(midAngle);
      const y = centerY + labelRadius * Math.sin(midAngle);
      return { x, y };
    }

    function drawCalloutLabel(text, x, y, bgColor) {
      ctx.font = "13px Arial";
      const textWidth = ctx.measureText(text).width + 12;
      const boxHeight = 20;
      const rectX = x - textWidth / 2;
      const rectY = y - boxHeight / 2;

      ctx.fillStyle = "#111";
      ctx.strokeStyle = bgColor;
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.roundRect(rectX, rectY, textWidth, boxHeight, 6);
      ctx.fill();
      ctx.stroke();

      ctx.fillStyle = bgColor;
      ctx.fillText(text, x, y + 1);
    }

    // Polyfill for roundRect
    if (!CanvasRenderingContext2D.prototype.roundRect) {
      CanvasRenderingContext2D.prototype.roundRect = function (x, y, w, h, r) {
        this.beginPath();
        this.moveTo(x + r, y);
        this.arcTo(x + w, y, x + w, y + h, r);
        this.arcTo(x + w, y + h, x, y + h, r);
        this.arcTo(x, y + h, x, y, r);
        this.arcTo(x, y, x + w, y, r);
        this.closePath();
        return this;
      };
    }

    function drawSessions() {
      const labelPositions = [];

      sessions.forEach((session, i) => {
        const radius = 180 - i * ringWidth;
        const { start, end, color, name } = session;

        if (end <= start) {
          const mid1 = drawSessionArc(start, 24, radius, color);
          const mid2 = drawSessionArc(0, end, radius, color);
          labelPositions.push({ name, color, x: mid1.x, y: mid1.y });
        } else {
          const mid = drawSessionArc(start, end, radius, color);
          labelPositions.push({ name, color, x: mid.x, y: mid.y });
        }
      });

      // Draw all labels after arcs
      labelPositions.forEach(({ name, x, y, color }) => {
        drawCalloutLabel(name, x, y, color);
      });
    }

    function drawTimeHand(hour, minute) {
      const hourDecimal = hour + minute / 60;
      const angle = (hourDecimal / 24) * 2 * Math.PI - Math.PI / 2;
      const handLength = 140;

      ctx.beginPath();
      ctx.moveTo(centerX, centerY);
      ctx.lineTo(centerX + handLength * Math.cos(angle), centerY + handLength * Math.sin(angle));
      ctx.strokeStyle = "#fff";
      ctx.lineWidth = 3;
      ctx.stroke();

      ctx.beginPath();
      ctx.arc(centerX, centerY, 5, 0, 2 * Math.PI);
      ctx.fillStyle = "#fff";
      ctx.fill();
    }

    function updateClock() {
      const now = new Date();
      const utc = now.getTime() + now.getTimezoneOffset() * 60000;
      const wib = new Date(utc + 7 * 3600000);
      const hour = wib.getHours();
      const minute = wib.getMinutes();

      drawClockFace();
      drawSessions();
      drawTimeHand(hour, minute);

      requestAnimationFrame(updateClock);
    }

    updateClock();
  </script>
</body>
</html>
