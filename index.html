<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Forex Sessions - WIB Time</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    h2, h3 {
      text-align: center;
    }
    #clock {
      text-align: center;
      font-size: 20px;
      margin-bottom: 15px;
    }
    .timeline-container {
      max-width: 1000px;
      margin: auto;
    }
    .session-row {
      position: relative;
      height: 60px;
      margin: 0;
      border: 1px solid #ccc;
      background: #fff;
      overflow: hidden;
    }
    .session-bar {
      position: absolute;
      height: 100%;
      color: white;
      padding: 5px;
      box-sizing: border-box;
      font-weight: bold;
      font-size: 14px;
    }
    .Sydney   { background: #1abc9c; }
    .Tokyo    { background: #3498db; }
    .London   { background: #9b59b6; }
    .NewYork  { background: #e67e22; }

    .cursor-line,
    .now-line {
      position: absolute;
      width: 1px;
      height: 100%;
      top: 0;
      z-index: 10;
    }

    .cursor-line {
      background: black;
    }
    .now-line {
      background: red;
    }

    .time-label {
      position: absolute;
      top: -22px;
      transform: translateX(-50%);
      background: #000;
      color: #fff;
      padding: 2px 5px;
      font-size: 12px;
      white-space: nowrap;
      display: none;
    }

    .session-info {
      font-size: 14px;
      margin-bottom: 5px;
      text-align: center;
    }

    .alert-bar {
      text-align: center;
      font-weight: bold;
      padding: 10px;
      background: #fffbcc;
      border: 1px solid #f1c40f;
      margin-top: 15px;
    }

    @media (max-width: 600px) {
      .session-bar {
        font-size: 12px;
        padding: 3px;
      }
      .session-info {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <h2>Forex Trading Sessions (WIB)</h2>
  <div id="clock"></div>
  <div class="alert-bar" id="alertBar">Hover over the chart to see time and session status.</div>

  <div class="timeline-container" id="timeline">
    <!-- Dynamic content -->
  </div>

  <script>
    const WIB_OFFSET = 7;  // WIB is UTC+7
    const timeline = document.getElementById('timeline');
    const alertBar = document.getElementById('alertBar');

    // Function to get current WIB time
    function getCurrentWIBTime() {
      const now = new Date();
      const utcHours = now.getUTCHours();
      const utcMinutes = now.getUTCMinutes();
      now.setHours(utcHours + WIB_OFFSET, utcMinutes);
      return now;
    }

    // Convert sessions to WIB
    const sessionsUTC = [
      { name: "Sydney",  start: 22, end: 7, color: "Sydney", utc: "+10" },
      { name: "Tokyo",   start: 0,  end: 9, color: "Tokyo", utc: "+09" },
      { name: "London",  start: 8,  end: 17, color: "London", utc: "+00" },
      { name: "New York",start: 13, end: 22, color: "NewYork", utc: "-05" }
    ];

    // Convert sessions to WIB times
    const sessionsWIB = sessionsUTC.map(session => {
      const start = (session.start + WIB_OFFSET) % 24;
      const end = (session.end + WIB_OFFSET) % 24;
      return { ...session, startWIB: start, endWIB: end };
    });

    // Create session bars and info
    sessionsWIB.forEach(session => {
      const row = document.createElement('div');
      row.className = 'session-row';

      const bar = document.createElement('div');
      bar.className = `session-bar ${session.color}`;

      let start = session.startWIB;
      let end = session.endWIB;
      let width, left;
      if (end > start) {
        width = ((end - start) / 24) * 100;
        left = (start / 24) * 100;
      } else {
        width = ((24 - start + end) / 24) * 100;
        left = (start / 24) * 100;
      }

      bar.style.left = `${left}%`;
      bar.style.width = `${width}%`;
      bar.textContent = `${String(start).padStart(2, '0')}:00 - ${String(end).padStart(2, '0')}:00 WIB`;

      const utcLabel = document.createElement('div');
      utcLabel.className = 'time-label';
      utcLabel.textContent = `UTC${session.utc}`;
      bar.appendChild(utcLabel);

      const cursorLine = document.createElement('div');
      cursorLine.className = 'cursor-line';

      const nowLine = document.createElement('div');
      nowLine.className = 'now-line';

      const timeLabel = document.createElement('div');
      timeLabel.className = 'time-label';

      row.appendChild(bar);
      row.appendChild(cursorLine);
      row.appendChild(nowLine);
      row.appendChild(timeLabel);
      timeline.appendChild(row);

      row.addEventListener('mousemove', (e) => {
        const rect = row.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const percent = x / rect.width;
        const totalMinutes = percent * 1440;
        let hour = Math.floor(totalMinutes / 60);
        let mins = Math.round((totalMinutes % 60) / 5) * 5;
        if (mins === 60) { mins = 0; hour = (hour + 1) % 24; }

        cursorLine.style.left = `${x}px`;
        cursorLine.style.display = 'block';

        timeLabel.textContent = `${String(hour).padStart(2, '0')}:${String(mins).padStart(2, '0')} WIB`;
        timeLabel.style.left = `${x}px`;
        timeLabel.style.display = 'block';

        const activeSessions = sessionsWIB.filter(s => isTimeInSession(hour, mins, s.startWIB, s.endWIB));
        if (activeSessions.length > 0) {
          alertBar.textContent = `At ${String(hour).padStart(2, '0')}:${String(mins).padStart(2, '0')} WIB → Active: ${activeSessions.map(s => s.name).join(", ")}`;
        } else {
          alertBar.textContent = `At ${String(hour).padStart(2, '0')}:${String(mins).padStart(2, '0')} WIB → No active session`;
        }
      });

      row.addEventListener('mouseleave', () => {
        cursorLine.style.display = 'none';
        timeLabel.style.display = 'none';
        alertBar.textContent = "Hover over the chart to see time and session status.";
      });

      function updateNowLine() {
        const now = getCurrentWIBTime();
        const wibH = now.getHours();
        const wibM = now.getMinutes();
        const totalMinutes = wibH * 60 + wibM;
        const percent = totalMinutes / 1440;
        nowLine.style.left = `${percent * 100}%`;
      }

      updateNowLine();
      setInterval(updateNowLine, 60000);
    });

    function isTimeInSession(hour, minutes, startWIB, endWIB) {
      const time = hour * 60 + minutes;
      const start = startWIB * 60;
      const end = endWIB * 60;
      if (end < start) {
        return time >= start || time < end;
      }
      return time >= start && time < end;
    }

    function checkIfOpen(session) {
      const now = getCurrentWIBTime();
      const hour = now.getHours();
      const minutes = now.getMinutes();
      return isTimeInSession(hour, minutes, session.startWIB, session.endWIB);
    }

    function updateClock() {
      const now = getCurrentWIBTime();
      const hours = now.getHours();
      const minutes = now.getMinutes();
      const seconds = now.getSeconds();
      document.getElementById('clock').textContent = `Current WIB Time: ${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    updateClock();
    setInterval(updateClock, 1000);
  </script>
</body>
</html>
