<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Forex Sessions Timeline (WIB)</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f4f4f4;
    }

    h2 {
      margin-bottom: 10px;
    }

    .timeline-container {
      position: relative;
      width: 100%;
      max-width: 100%;
      overflow-x: auto;
    }

    .timeline {
      position: relative;
      height: 240px;
      border: 1px solid #ccc;
      min-width: 1000px;
    }

    .session {
      position: absolute;
      height: 40px;
      border-radius: 4px;
      color: white;
      padding-left: 5px;
      line-height: 40px;
      font-weight: bold;
    }

    .Sydney { background: #3f51b5; top: 0; }
    .Tokyo { background: #4caf50; top: 50px; }
    .London { background: #ff9800; top: 100px; }
    .NewYork { background: #f44336; top: 150px; }

    .cursor {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 2px;
      background: black;
      z-index: 2;
    }

    .time-label, .status-label {
      margin-top: 10px;
      font-weight: bold;
    }

    .hour-mark {
      position: absolute;
      top: 190px;
      height: 10px;
      border-left: 1px solid #888;
      color: #333;
      font-size: 10px;
      text-align: center;
    }

    .live-clock {
      font-family: monospace;
      font-size: 18px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h2>Forex Market Sessions Timeline (WIB)</h2>
  <div class="live-clock" id="live-clock"></div>
  <div class="timeline-container">
    <div class="timeline" id="timeline">
      <div class="cursor" id="cursor"></div>
    </div>
  </div>
  <div class="time-label" id="current-time-label"></div>
  <div class="status-label" id="status-label"></div>

  <script>
    const timeline = document.getElementById('timeline');
    const cursor = document.getElementById('cursor');
    const timeLabel = document.getElementById('current-time-label');
    const statusLabel = document.getElementById('status-label');
    const liveClock = document.getElementById('live-clock');

    let timelineWidth = timeline.offsetWidth;

    const sessions = [
      { name: 'Sydney', startUTC: 21, endUTC: 6, class: 'Sydney' },
      { name: 'Tokyo', startUTC: 0, endUTC: 9, class: 'Tokyo' },
      { name: 'London', startUTC: 7, endUTC: 16, class: 'London' },
      { name: 'New York', startUTC: 12, endUTC: 21, class: 'NewYork' },
    ];

    function convertToWIB(hour) {
      return (hour + 7) % 24;
    }

    function toPixels(hour) {
      return (hour / 24) * timelineWidth;
    }

    function renderHourMarks() {
      for (let i = 0; i <= 24; i++) {
        const hourMark = document.createElement('div');
        hourMark.classList.add('hour-mark');
        hourMark.style.left = toPixels(i) + 'px';
        hourMark.innerText = i;
        timeline.appendChild(hourMark);
      }
    }

    function renderSessions() {
      timeline.querySelectorAll('.session').forEach(el => el.remove());

      sessions.forEach(session => {
        const startWIB = convertToWIB(session.startUTC);
        const endWIB = convertToWIB(session.endUTC);
        const sessionDiv = document.createElement('div');
        sessionDiv.classList.add('session', session.class);

        let left, width;

        if (startWIB < endWIB) {
          left = toPixels(startWIB);
          width = toPixels(endWIB - startWIB);
        } else {
          // Spans midnight
          left = toPixels(startWIB);
          width = toPixels(24 - startWIB) + toPixels(endWIB);
        }

        sessionDiv.style.left = left + 'px';
        sessionDiv.style.width = width + 'px';
        sessionDiv.innerText = session.name;
        timeline.appendChild(sessionDiv);
      });
    }

    function getCurrentWIBTime() {
      const now = new Date();
      const wibHour = (now.getUTCHours() + 7) % 24;
      const wibMinutes = now.getUTCMinutes();
      const seconds = now.getUTCSeconds();
      return { hour: wibHour, minutes: wibMinutes, seconds };
    }

    function updateClockAndCursor() {
      const now = new Date();
      const { hour, minutes, seconds } = getCurrentWIBTime();
      const totalHour = hour + minutes / 60 + seconds / 3600;
      const cursorX = toPixels(totalHour);

      cursor.style.left = cursorX + 'px';
      timeLabel.innerText = `Current Time in Jakarta (WIB): ${String(hour).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
      liveClock.innerText = now.toLocaleTimeString('en-GB', { hour12: false, timeZone: 'Asia/Jakarta' });

      // Highlight active session
      const activeSessions = sessions.filter(s => {
        const start = convertToWIB(s.startUTC);
        const end = convertToWIB(s.endUTC);
        if (start < end) {
          return totalHour >= start && totalHour < end;
        } else {
          return totalHour >= start || totalHour < end;
        }
      });

      if (activeSessions.length > 0) {
        statusLabel.innerText = `Active Session: ${activeSessions.map(s => s.name).join(', ')}`;
      } else {
        statusLabel.innerText = 'No active session currently.';
      }

      requestAnimationFrame(updateClockAndCursor);
    }

    function resizeHandler() {
      timelineWidth = timeline.offsetWidth;
      timeline.innerHTML = '';
      renderHourMarks();
      renderSessions();
    }

    renderHourMarks();
    renderSessions();
    updateClockAndCursor();
    window.addEventListener('resize', resizeHandler);
  </script>
</body>
</html>
